<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
   	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Les Cordons Bleus</title>
</head>

<body>

    <!-- Navbar Top -->
    <nav class="navbar navbartop navbar-expand-sm navbar-light bg-light">
        <a href="index.html" class="navbar-brand">
            <img src="./images/chef.png" height="30" alt="Les Cordons Bleus">Les Cordons Bleus
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>    
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ml-auto">
                <a href="connexion.html" class="nav-item nav-link" title="Connexion"><img src="./images/nav_user.png" height="35" alt="login"></a>
            </div>
        </div>
    </nav>

    <!-- Liste mes recettes -->
<div class="maCreationR">

    <!-- card -->
    <div class="card shadow p-3 mb-5 bg-white rounded">
        <div class="card-body cardR">
        	<form id="formulaire">
            <h1 class="text-center titreCardRecette">Ajouter une recette</h1>
            
            <!-- partie Titre et nombre de personnes de la recette -->
			<!-- Titre de la recette -->
               <div class="form-group recetteTitre mt-5">
			    <label for="recetteTitre">Titre de la recette :</label>
			    <input type="text" class="form-control" id="recetteTitre" placeholder="titre">
			</div>
			<div class="row">
				<div class="form-group col-md-8">
				      <label for="inputState">Nombre de personnes : </label>
				      <select id="nbPers" class="form-control">
					        <option selected>Faites votre choix...</option>
					        <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
					        <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
				      </select>
		    	</div>
           	</div>
                
                
            <p class="card-text titreinfo1R">Selectionnez vos ingrédients et la quantité :</p>
                <div class="row">              
                	<!-- liste groupe ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4 form1" >
                            <select class="custom-select mr-sm-2 select1" id="cat1"> 
                            	<option selected>Faites votre choix...</option>           
                            </select>
                        </div>
                    </div>
					<!-- liste sous groupe ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4">
                            <select class="custom-select mr-sm-2 select2" id="cat2">
                            	<option selected>Faites votre choix...</option> 
                            </select>
                        </div>
                    </div>
					<!-- liste sous sous groupe ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4">
                            <select class="custom-select mr-sm-2 select3" id="cat3">
                            	<option selected>Faites votre choix...</option> 
                            </select>
                        </div>
                    </div>               
                    <!-- liste ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4">
                            <select class="custom-select mr-sm-2 select4" id="cat4">
                            	<option selected>Faites votre choix...</option> 
                            </select>
                        </div>
                    </div>     
                </div>

                <!-- Poids -->
                <div class="row">
                    <div class="col-4 poidsR">
                        <div class="input-group">
                            <input type="text" class="form-control poidsAlim" id="poidsAlim" aria-label="Text input with segmented dropdown button" placeholder="quantité">
                            <select class="form-control select5">
                                    <option value="1" selected>Grammes</option>
                                    <option value="2">Litres</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Validation -->
                <div class="row">
                    <div class="col text-right">
                        <button type="submit" class="btn btn-success validIngredient">Valider</button>
                    </div>
                </div>
		
				<!-- Liste des ingrédients sélectionnés avec leur quantité -->
                <div class="mt-5" id="conteneurListeIngredients">
	                <ul class="list-group list-group-flush conteneurListeIngredients">
	                </ul>
                </div>
	
				<div class="card mt-5">
  					<div class="card-body">
                    	<h2 class="d-flex justify-content-center">Tableau nutritionnel</h2>

	                    <table class="table table-striped mt-4 tableauNutri">
						  <thead>
						    <tr>
						      <th scope="col">Nutriments</th>
						      <th scope="col">total ingrédients</th>
						      <th scope="col">par personne</th>
						    </tr>
						  </thead>
						  <tbody>
						    <tr>
						      <th scope="row" class="nut" id="lipides">Lipides : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="proteines">Protéines : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="glucides">Glucides : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="fer">Fer : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="calcium">Calcium : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="energie">Energie : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="cholesterol">Cholesterol : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="sucres">Sucres : </th>
						      <td></td>
						      <td></td>
						    </tr>					    					    
						    <tr>
						      <th scope="row" class="nut" id="amidon">Amidon : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="energie">Energie : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="sel">Sel : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="iode">Iode : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="eau">Eau : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="betaCarotene">Beta Carotène : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="vitamineC">Vitamines C : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="vitamineE">Vitamines E : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="vitamineB1">Vitamines B1 : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="vitamineB12">Vitamines B12 : </th>
						      <td></td>
						      <td></td>
						    </tr>					    
						    <tr>
						      <th scope="row" class="nut" id="vitamineD">Vitamines D : </th>
						      <td></td>
						      <td></td>
						    </tr>
						    <tr>
						      <th scope="row" class="nut" id="fibresAlimentaires">Fibres Alimentaires : </th>
						      <td></td>
						      <td></td>
						    </tr>					    					    					    					    					    
						  </tbody>
						</table>

                <div class="recettePreparation">
                    <div class="form-group">
                        <label class="titreinfo1R" for="exampleFormControlTextarea1">Préparation :</label>
                        <textarea class="form-control" id="prepaRecette" rows="5" placeholder="instructions..."></textarea>
                    </div>
                </div>
              	


                <!-- Validation Recette -->
                <div class="row mt-5">
                    <div class="col validAjouR text-right">
                        <button type="submit" id="validRecette" class="btn btn-success btn-lg btn-block">Valider votre recette</button>
                    </div>
                </div>
                
                <!--  
                Validation et annulation preparation
               	<div class="d-flex justify-content-end align-items-center">
                	<input class="btn btn-danger resetPrepa" type="reset" value="Annuler">
					<input class="btn btn-success validPrepa" type="submit" value=" Valider ">
               	</div>
               	-->
               	
            </form>
        </div>
    </div>
</div>
    


    <!-- Footer en mode Desktop-->
    <div class="footerDesktop">
        <div class="footertext1">made with ♥ by LCB
        </div>
        <div class="footertext-links">
            <p>Tous droits réservés Les Cordons Bleus - 2019</br>
                Vous avez une question ? <a href="">nous contacter</a> ∗ 
                <a href="">Mentions légales</a> ∗ 
                <a href="">Conditions Générales d'Utilisation</a> ∗ 
                <a href="">Contact</a> ∗ 
                <a href="">Politique de protection des données personnelles</a> ∗ 
                <a href="">Politique de confidentialité</a> 
            </p>
        </div>
    </div>
    

    <!-- Navbar bottom format mobile xs -->
    <nav class="navbar navbarbottom fixed-bottom navbar-light bg-light">
        <a href="index.html" class="nav-item nav-link"><img src="./images/nav_home.png" height="40" alt="login"></a>
        <a href="#" class="nav-item nav-link"><img src="./images/nav_heart.png" height="40" alt="login"></a>
        <a href="connexion.html" class="nav-item nav-link"><img src="./images/nav_user.png" height="40" alt="login"></a>
        <a href="#" class="nav-item nav-link"><img src="./images/nav_engrenage.png" height="45" alt="login"></a>
    </nav>


	<script>

        var poids;
        var ingredientValue;
        var unite;
        var proprietesIngredient;
        var titreRecette;
        var nbPers;
		var prepaRecette
        
        recupListes();
        
		// Validation Recette
        // Validation Titre et nombre de personnes / Récupération des valeurs
        $("#validRecette").on('click', function() {
        	titreRecette = $("#recetteTitre").val(); 
        	nbPers = $("#nbPers").val();
        	prepaRecette = $("#prepaRecette").val();
        	$("#formulaire")[0].reset();
        	$(".nut").children().remove();
        	$(".conteneurListeIngredients").children().remove();
        	console.log("titre : " + titreRecette + ", Nb pers : " + nbPers + ", Prépa : " + prepaRecette);
        	recupListes();
        })

     	// Annulation 
        //$(".resetPrepa").on('click', function() {
        	//prepaRecette = $("#prepaRecette").val(""); 
		//})

        
	    function recupListes(){
	    	var liste;
	    	var numListe;
         	var value1;
         	var value2;
         	var value3;
         	var value4;
         	
         // tableaux recupération ingredients

	        $.ajax({
	            type: 'get',
	            contentType: "application/json",
	            url: "http://localhost:8080/groupe/all/",
	            }).done(function(data) {
	            datas = data;

	 			console.log(data);

	            // liste 1 groupe ingrédient 
	            numListe = 1;
	            for (var i = 0; i < datas.length; i++) {
	            	console.log(datas.length);
	                var titre1 = datas[i].lib;
	                $(".select"+numListe).append("<option type=text value="+i+" onclick=selectListe1()>"+titre1+"</option>"); 
	            }
	            
	            // Récupération valeur 1ère liste :
	            $(".select1").on('change', function() {
	            	  value1 = $(this).val();
	            	  $(".select2").empty();
	            	  $(".select3").empty();
	            	  $(".select4").empty();
	            	  
	            	// liste 2 sous groupe ingrédient       	
	  	         	numListe = 2;
	  	         	$(".select"+numListe).append("<option selected>Faites votre choix...</option>");
	  	            for (var j = 0; j < datas[value1].sousGroupeIngredient.length; j++) {
	  	                var titre2 = datas[value1].sousGroupeIngredient[j].lib;
	  	                $(".select"+numListe).append("<option type=text value="+j+" onclick=selectListe2()>"+titre2+"</option>"); 
	  	            }
	  	            
	  	       		// Récupération valeur 2ème liste :
		            $('.select2').on('change', function() {
		            	  value2 = $(this).val();
		            	  $(".select3").empty();
		            	  $(".select4").empty();
	  	            
		  	       		// liste 3 sous sous groupe ingrédient 
			         	numListe = 3;
			         	$(".select"+numListe).append("<option selected>Faites votre choix...</option>");
			            for (var k = 0; k < datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient.length; k++) {
			                var titre3 = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[k].lib;
			                $(".select"+numListe).append("<option type=text value="+k+" onclick=selectListe3()>"+titre3+"</option>"); 
			            }
			         	
			         	// Récupération valeur 3ème liste :
			            $('.select3').on('change', function() {
			            	  value3 = $(this).val();
			            	  $(".select4").empty();
		            	  
			            	// liste 4 ingrédient 
				         	numListe = 4;	
				         	$(".select"+numListe).append("<option selected>Faites votre choix...</option>");
				            for (var l = 0; l < datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients.length; l++) {
				            	console.log("select4")
				                var titre4 = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[l].alimNom;
				                $(".select"+numListe).append("<option type=text id="+l+" value="+l+" onclick=selectListe3()>"+titre4+"</option>"); 
				            }
					         	
				         	// Récupération valeur 4ème liste :
				            $('.select4').on('change', function() {
				            	value4 = $(this).val();
                                ingredientValue = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4].alimNom;
                                proprietesIngredient = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4];

					            console.log(ingredientValue,proprietesIngredient);
					           
								
						         // Récupération de la valeur poids ingredient avec validation :
							        $(".validIngredient").click(function(event) {
                                        // Poids quantité aliment champ poidsRecette
                                        console.log(proprietesIngredient.amidon);
                                        
                                        event.preventDefault();
										

                                     $("#validRecette").click(function(event){    
                                         calculTotalNutriments();
                                         /*
                                         $.ajax({
                                             type: 'POST',
                                             url: "http://localhost:8080/recette",
                                             //headers:
                                             }).done(function(data) {  
                                         })
                                         */
                                         event.preventDefault();
                                     })
                                 })
				            })
	            		})
		        	})
	        	})
			})
			
        }
        
        // AFFICHAGE DE LA LISTE DES INGREDIENTS
	    $(".validIngredient").click(function(event) {
	    	poids = $(".poidsAlim").val();
            unite = $(".select5").val();
            if(unite == 1){
                unite = "grammes";
            } else if (unite == 2){
                unite = "litres";
            } else {
                unite = "";
                poids = "";
            }



            afficheIngredient();
            afficheTableauNutritionnel();
	    })
        
        
        
		// AFFICHAGE DE LA LISTE DES INGREDIENTS 
        function afficheIngredient(){
            if (unite == ""){
            	$(".conteneurListeIngredients").append('<li class="list-group-item">'+ingredientValue+'</li>');
            } else {
            	$(".conteneurListeIngredients").append('<li class="list-group-item">'+poids+" "+unite+" de "+ingredientValue+'</li>');
            }
        }

        // REMPLISSAGE DU TABLEAU CONTENANT TOUTES LES VALEURS NUTRITIONNELLES PAR INGREDIENT ET EN FONCTION DE LA QUANTITE 
        function afficheTableauNutritionnel(){
        	$("#amidon").children().append("<td class='nutri amidon'>"+proprietesIngredient.amidon/100*poids+" </td>");
            $("#betaCarotene").children().append("<td class='nutri betaCarotene'>"+proprietesIngredient.betaCarotene/100*poids+" </td>");
            $("#calcium").append("<td class='nutri calcium'>"+proprietesIngredient.calcium/100*poids+" </td>");
            $("#cholesterol").append("<td class='nutri cholesterol'>"+proprietesIngredient.cholosterol/100*poids+" </td>");
            $("#eau").append("<td class='nutri eau'>"+proprietesIngredient.eau/100*poids+" </td>");
            $("#energie").append("<td class='nutri energie'>"+proprietesIngredient.energie/100*poids+" </td>");
            $("#fer").append("<td class='nutri fer'>"+proprietesIngredient.fer/100*poids+" </td>");
            $("#fibresAlimentaires").append("<td class='nutri fibresAlimentaires'>"+proprietesIngredient.fibresAlimentaires/100*poids+" </td>");
            $("#glucides").append("<td class='nutri glucides'>"+proprietesIngredient.glucides/100*poids+" </td>");
            $("#iode").append("<td class='nutri iode'>"+proprietesIngredient.iode/100*poids+" </td>");
            $("#lipides").append("<td class='nutri lipides'>"+proprietesIngredient.lipides/100*poids+" </td>");
            $("#proteines").append("<td class='nutri proteines'>"+proprietesIngredient.proteines/100*poids+" </td>");
            $("#sel").append("<td class='nutri sel'>"+proprietesIngredient.sel/100*poids+" </td>");
            $("#sucres").append("<td class='nutri sucres'>"+proprietesIngredient.sucres/100*poids+" </td>");
            $("#vitamineB1").append("<td class='nutri vitamineB1'>"+proprietesIngredient.vitamineB1/100*poids+" </td>");
            $("#vitamineB12").append("<td class='nutri vitamineB12'>"+proprietesIngredient.vitamineB12/100*poids+" </td>");
            $("#vitamineC").append("<td class='nutri vitamineC'>"+proprietesIngredient.vitamineC/100*poids+" </td>");
            $("#vitamineD").append("<td class='nutri vitamineD'>"+proprietesIngredient.vitamineD/100*poids+" </td>");
            $("#vitamineE").append("<td class='nutri vitamineE'>"+proprietesIngredient.vitamineE/100*poids+" </td>");
        }
        

        // CALCUL DU TOTAL PAR NUTRIMENT DE LA RECETTE
        function calculTotalNutriments(){
            
            var totalAmidon = 0;
            var totalBetaCarotene = 0;
            var totalCalcium = 0;
            var totalCholesterol = 0;
            var totalEau = 0;
            var totalEnergie =0;
            var totalFer=0;
            var totalFibresAlimentaires=0;
            var totalGlucides=0;
            var totalIode=0;
            var totalLipides=0;
            var totalProteines=0;
            var totalSel=0;
            var totalSucres=0;
            var totalVitamineB1=0;
            var totalVitamineB12=0;
            var totalVitamineC=0;
            var totalVitamineD=0;
            var totalVitamineE=0;

            var amidon = $(".amidon");
            var betaCarotene = $(".betaCarotene");
            var calcium = $(".calcium");
            var cholesterol= $(".cholesterol");
            var eau= $(".eau");
            var energie= $(".energie");
            var fer= $(".fer");
            var fibresAlimentaires= $(".fibresAlimentaires");
            var glucides= $(".glucides");
            var iode= $(".iode");
            var lipides= $(".lipides");
            var proteines= $(".proteines");
            var sel= $(".sel");
            var sucres= $(".sucres");
            var vitamineB1= $(".vitamineB1");
            var vitamineB12= $(".vitamineB12");
            var vitamineC= $(".vitamineC");
            var vitamineD= $(".vitamineD");
            var vitamineE= $(".vitamineE");

            for(var i = 0 ; i < amidon.length; i++){
                totalAmidon = totalAmidon + parseFloat(amidon[i].childNodes[0].data);
                totalBetaCarotene = totalBetaCarotene + parseFloat(betaCarotene[i].childNodes[0].data);
                totalCalcium = totalCalcium + parseFloat(calcium[i].childNodes[0].data);
                totalCholesterol = totalCholesterol + parseFloat(cholesterol[i].childNodes[0].data);
                totalEau = totalEau + parseFloat(eau[i].childNodes[0].data);
                totalEnergie = totalEnergie + parseFloat(energie[i].childNodes[0].data);
                totalFer = totalFer + parseFloat(fer[i].childNodes[0].data);
                totalFibresAlimentaires = totalFibresAlimentaires + parseFloat(fibresAlimentaires[i].childNodes[0].data);
                totalGlucides = totalGlucides + parseFloat(glucides[i].childNodes[0].data);
                totalIode = totalIode + parseFloat(iode[i].childNodes[0].data);
                totalLipides = totalLipides + parseFloat(lipides[i].childNodes[0].data);
                totalProteines = totalProteines + parseFloat(proteines[i].childNodes[0].data);
                totalSel = totalSel + parseFloat(sel[i].childNodes[0].data);
                totalSucres = totalSucres + parseFloat(sucres[i].childNodes[0].data);
                totalVitamineB1 = totalVitamineB1 + parseFloat(vitamineB1[i].childNodes[0].data);
                totalVitamineB12 = totalVitamineB12 + parseFloat(vitamineB12[i].childNodes[0].data);
                totalVitamineC = totalVitamineC + parseFloat(vitamineC[i].childNodes[0].data);
                totalVitamineD = totalVitamineD + parseFloat(vitamineD[i].childNodes[0].data);
                totalVitamineE = totalVitamineE + parseFloat(vitamineE[i].childNodes[0].data);
                

            }
           
            console.log(totalAmidon,totalBetaCarotene,totalCalcium,totalCholesterol,totalEau,totalEnergie,totalFer,totalFibresAlimentaires,totalGlucides,totalIode,totalLipides,totalProteines,totalSel,totalSucres,totalVitamineB1,totalVitamineB12,totalVitamineC,totalVitamineD,totalVitamineE);
            
            $("#amidon").append("<td class='total'>"+totalAmidon+"</td>");
            $("#betaCarotene").append("<td class='total'>"+totalBetaCarotene+"</td>");
            $("#calcium").append("<td class='total'>"+totalCalcium+"</td>");
            $("#cholesterol").append("<td class='total'>"+totalCholesterol+"</td>");
            $("#eau").append("<td class='total'>"+totalEau+"</td>");
            $("#energie").append("<td class='total'>"+totalEnergie+"</td>");
            $("#fer").append("<td class='total'>"+totalFer+"</td>");
            $("#fibresAlimentaires").append("<td class='total'>"+totalFibresAlimentaires+"</td>");
            $("#glucides").append("<td class='total'>"+totalGlucides+"</td>");
            $("#iode").append("<td class='total'>"+totalIode+"</td>");
            $("#lipides").append("<td class='total'>"+totalLipides+"</td>");
            $("#proteines").append("<td class='total'>"+totalProteines+"</td>");
            $("#sel").append("<td class='total'>"+totalSel+"</td>");
            $("#sucres").append("<td class='total'>"+totalSucres+"</td>");
            $("#vitamineB1").append("<td class='total'>"+totalVitamineB1+"</td>");
            $("#vitamineB12").append("<td class='total'>"+totalVitamineB12+"</td>");
            $("#vitamineC").append("<td class='total'>"+totalVitamineC+"</td>");
            $("#vitamineD").append("<td class='total'>"+totalVitamineD+"</td>");
            $("#vitamineE").append("<td class='total'>"+totalVitamineE+"</td>");
            $(".nutri").remove();

        }

	</script>
  </body>
</html>
