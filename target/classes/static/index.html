<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
    <title>Les Cordons Bleus</title>
</head>

    <body>

        <!-- Navbar Top -->
        <nav class="navbar navbartop navbar-expand-sm navbar-light bg-light">
            <a href="accueil.html" class="navbar-brand">
                <img src="./images/chef.png" height="30" alt="Les Cordons Bleus">Les Cordons Bleus
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ml-auto" id="open_menu_nav">
                    <img src="./images/nav_user.png" height="35" alt="login" style="font-size:30px;cursor:pointer" onclick="openNav()">
                </div>
            </div>
            <!-- Menu caché -->
            <div id="mySidenav" class="sidenav">
			  	<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
			  	<a href="" id="accueil">Accueil</a>
	            <a href="javascript:update('mes_recettes');">Mes recettes</a>
	            <a href="javascript:update('mes_favoris');">Mes favoris</a>
	            <a href="connexion.html" id="bouton_connexion">Connexion</a>
	            <a href="">Paramètres</a>
	            <a href="javascript:deconnexion()" id="bouton_deconnexion">Deconnexion</a>
			</div>
        </nav>


        <!-- Recherche -->
        <div class="input-group col-md-8 col-sm-10 row border border-secondary rounded-pill mx-auto my-3 p-0" style="height: 8vh">
            <input type="search" placeholder="nom de recette ou ...." aria-describedby="button-addon1"
                class="search_bar form-control border-0 m-0 bg-light" style="height:100%" id="search">
            <button id="button-addon1" type="submit" class="btn btn-link text-primary m-0" onclick="search()">
                <img class="search_icon p-0 m-0" src="https://img.icons8.com/cotton/25/000000/search--v5.png">
            </button>
        </div>

        <!-- Liste des recettes -->
        <div class="container recettes">
            <div class="row recettesRow">
				
				
				<div class="card" style="width: 20rem;">
				  <img class="card-img-top" src="https://cdn.pixabay.com/photo/2018/02/05/19/12/strawberry-3132973_960_720.jpg" alt="Card image cap">
				  <div class="card-body">
				    <h5 class="card-title text-center">Le titre de la recette</h5>
				    <p class="card-text text-justify " style="max-heigth: 10ch; "> Les instructions de la recette va apparaitre ici : Some quick example text to build on the card title and make up the bulk of the card's content.</p>
				  </div>
				  <div class="card-body">
				    <a href="#" class="card-link text-center">Voir la recette</a>
				  </div>
				</div>
				
		
            </div>
        </div>

        <!-- Footer en mode Desktop-->
        <div class="footerDesktop">
            <div class="footertext1">made with ♥ by LCB
            </div>
            <div class="footertext-links">
                <p>Tous droits réservés Les Cordons Bleus - 2019</br>
                    Vous avez une question ? <a href="">nous contacter</a> ∗
                    <a href="">Mentions légales</a> ∗
                    <a href="">Conditions Générales d'Utilisation</a> ∗
                    <a href="">Contact</a> ∗
                    <a href="">Politique de protection des données personnelles</a> ∗
                    <a href="">Politique de confidentialité</a>
                </p>
            </div>
        </div>

        <!-- Navbar bottom format mobile xs -->
        <nav class="navbar navbarbottom fixed-bottom navbar-light bg-light">
            <a href="index.html" class="nav-item nav-link"><img src="./images/nav_home.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_heart.png" height="40" alt="login"></a>
            <a href="connexion.html" class="nav-item nav-link"><img src="./images/nav_user.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_engrenage.png" height="45" alt="login"></a>
        </nav>



        
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    </body>

    <script>
    
    function openNav() {
    	  document.getElementById("mySidenav").style.width = "250px";
    	}

    	function closeNav() {
    	  document.getElementById("mySidenav").style.width = "0";
    	}
    /*
    	image();
        $("#menu_navigation").hide();
        $("#open_menu_nav").click(function(){
            $("#menu_navigation").toggle();
            $("#bouton_connexion").show();
            let user = sessionStorage.getItem('Mail')
            if ( user == null){
                $("#bouton_deconnexion").hide();
                
                
            }
            else {
            	$("#bouton_connexion").hide();
            	getPseudo();
            }
        })
       */ 
       function update(url){
        let pseudo = sessionStorage.getItem('Mail');
        connection(pseudo, url);
        }
        function connection(pseudo, url){
            if (pseudo == null){
                document.location.href="connexion.html";
            }
            else{
                document.location.href=""+url+".html";
            }
        }
        function deconnexion(){
            sessionStorage.clear();
            $("#menu_navigation").hide();
            $("#pseudo").remove();
            }

    function search() {
        let recherche = $("#search").val();
        $.ajax({
            url: "http://localhost:8080/recette/search",
            headers: { "lib": recherche },
            type: 'GET',
            dataType: "json",
            timeout: 15000
        }).done(
            function (data) {              
                let i = 0;
                while (i < 3) {
                    if (i < data.length) {
                        document.getElementById("image" + i + "").src = "data:image/png;base64," + data[i].image + "";
                        document.getElementById("title" + i + "").textContent = "" + data[i].lib + "";
                    }
                    else {
                        document.getElementById("card" + i + "").remove();
                    }
                    i++;
                }
            });                    
            }
    function image() {
         $.ajax({
            url: "http://localhost:8080/recette/homePageRecette",
            type: 'GET',
            dataType: "json",
            timeout: 15000
        }).done(
            function (data) {
                for (let i = 0; i < data.length; i++) {
                    document.getElementById("image"+i+"").src="data:image/png;base64,"+data[i].image+"";
                    document.getElementById("title"+i+"").textContent=""+data[i].lib+"";
                }
            });     
            
        }
        function getPseudo() {
        	let tempMail = sessionStorage.getItem('Mail');
        	let tempPassword = sessionStorage.getItem('Password');
        	console.log(tempMail, tempPassword);
            $.ajax({ 
                    url: "http://localhost:8080/utilisateur/connexion", 
                    headers: { "mail" : tempMail , "password" : tempPassword},
                    type: 'GET',
                    dataType:"json",
                    timeout: 15000
                }).done(
                    function(data) { 
                    	console.log(data.pseudo);
                        $("#menu_navigation").prepend("<p id='pseudo'>Bienvenue "+data.pseudo+"");
                    });
        }
    </script>


</html>
