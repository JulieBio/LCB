<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>
    <title>Les Cordons Bleus</title>
</head>

    <body>

        <!-- Navbar Top -->
        <nav class="navbar navbartop navbar-expand-sm navbar-light bg-light">
            <a href="index.html" class="navbar-brand">
                <img src="./images/chef.png" height="30" alt="Les Cordons Bleus">Les Cordons Bleus
            </a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ml-auto" id="open_menu_nav">
                    <img src="./images/nav_user.png" height="35" alt="login">
                </div>
            </div>
        </nav>

        <!-- Menu caché -->
        <div id="menu_navigation">
            <a href="" id="accueil">Accueil</a>
            <a href="javascript:update('mes_recettes');">Mes recettes</a>
            <a href="javascript:update('mes_favoris');">Mes favoris</a>
            <a href="connexion.html" id="bouton_connexion">Connexion</a>
            <a href="">Paramètres</a>
            <a href="javascript:deconnexion()" id="bouton_deconnexion">Deconnexion</a>
        </div>

        <!-- Recherche -->
        <div class="input-group col-md-8 col-sm-10 row border border-secondary rounded-pill mx-auto my-3 p-0" style="height: 8vh">
            <input type="search" placeholder="nom de recette ou ...." aria-describedby="button-addon1"
                class="search_bar form-control border-0 m-0 bg-light" style="height:100%" id="search">
            <button id="button-addon1" type="submit" class="btn btn-link text-primary m-0" onclick="search()">
                <img class="search_icon p-0 m-0" src="https://img.icons8.com/cotton/25/000000/search--v5.png">
            </button>
        </div>

        <!-- Liste des recettes -->
        <div class="container recettes">
            <div class="row recettesRow" id="afficheRecette">

                <div class="card-deck" id="card-deck">
                    <div class="card" id="card0">
                        <img class="card-img-top" id="image0"
                            src="https://cdn.pixabay.com/photo/2018/02/05/19/12/strawberry-3132973_960_720.jpg"
                            alt="Card image cap">
                        <div class="card-body">
                            <h5 class="card-title" id="title0">Card title</h5>
                            <p class="card-text" id="text0">This is a longer card with supporting text below as a natural lead-in to
                                additional content. This content is a little bit longer.</p>
                        </div>
                        <div class="card-footer text-center">
                            <a href="#" class="card-link lienIcone col"><img src="./images/card_heart.png" width="30"
                                    height="30" class="imgIcone" alt="Liker">
                            </a>
                            <a href="#" class="card-link lienIcone col"><img src="./images/card_share.png" width="30"
                                    height="30" class="imgIcone" alt="Partager">
                            </a>
                        </div>
                    </div>

                    <div class="card" id="card1">
                        <img class="card-img-top" id="image1"
                            src="https://cdn.pixabay.com/photo/2015/09/16/20/10/pancakes-943246_960_720.jpg"
                            alt="Card image cap">
                        <div class="card-body">
                            <h5 class="card-title" id="title1">Card title</h5>
                            <p class="card-text" id="text1">This card has supporting text below as a natural lead-in to additional
                                content.</p>
                        </div>
                        <div class="card-footer text-center">
                            <a href="#" class="card-link lienIcone col"><img src="./images/card_heart.png" width="30"
                                    height="30" class="imgIcone" alt="Liker">
                            </a>
                            <a href="#" class="card-link lienIcone col"><img src="./images/card_share.png" width="30"
                                    height="30" class="imgIcone" alt="Partager">
                            </a>
                        </div>
                    </div>

                    <div class="card" id="card2">
                        <img class="card-img-top" id="image2"
                            src="https://cdn.pixabay.com/photo/2017/03/19/18/22/italian-food-2157246_960_720.jpg"
                            alt="Card image cap">
                        <div class="card-body">
                            <h5 class="card-title" id="title2">Card title</h5>
                            <p class="card-text" id="text2">This is a wider card with supporting text below as a natural lead-in to
                                additional content. This card has even longer content than the first to show that equal
                                height action.</p>
                        </div>
                        <div class="card-footer text-center">
                            <a href="#" class="card-link lienIcone col"><img src="./images/card_heart.png" width="30"
                                    height="30" class="imgIcone" alt="Liker">
                            </a>
                            <a href="#" class="card-link lienIcone col"><img src="./images/card_share.png" width="30"
                                    height="30" class="imgIcone" alt="Partager">
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer en mode Desktop-->
        <div class="footerDesktop">
            <div class="footertext1">made with ♥ by LCB
            </div>
            <div class="footertext-links">
                <p>Tous droits réservés Les Cordons Bleus - 2019</br>
                    Vous avez une question ? <a href="">nous contacter</a> ∗
                    <a href="">Mentions légales</a> ∗
                    <a href="">Conditions Générales d'Utilisation</a> ∗
                    <a href="">Contact</a> ∗
                    <a href="">Politique de protection des données personnelles</a> ∗
                    <a href="">Politique de confidentialité</a>
                </p>
            </div>
        </div>

        <!-- Navbar bottom format mobile xs -->
        <nav class="navbar navbarbottom fixed-bottom navbar-light bg-light">
            <a href="index.html" class="nav-item nav-link"><img src="./images/nav_home.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_heart.png" height="40" alt="login"></a>
            <a href="connexion.html" class="nav-item nav-link"><img src="./images/nav_user.png" height="40" alt="login"></a>
            <a href="#" class="nav-item nav-link"><img src="./images/nav_engrenage.png" height="45" alt="login"></a>
        </nav>



        
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    </body>

    <script>
    	image();
        $("#menu_navigation").hide();
        $("#open_menu_nav").click(function(){
            $("#menu_navigation").toggle();
            $("#bouton_connexion").show();
            let user = sessionStorage.getItem('Mail')
            if ( user == null){
                $("#bouton_deconnexion").hide();               
            }
            else {
            	$("#bouton_connexion").hide();
            	getPseudo();
            }
        })
        
       function update(url){
        let pseudo = sessionStorage.getItem('Mail');
        connection(pseudo, url);
        }
        function connection(pseudo, url){
            if (pseudo == null){
                document.location.href="connexion.html";
            }
            else{
                document.location.href=""+url+".html";
            }
        }
        function deconnexion(){
            sessionStorage.clear();
            $("#menu_navigation").hide();
            $("#pseudo").remove();
            }

    function search() {
        let recherche = $("#search").val();
        $.ajax({
            url: "http://localhost:8080/recette/search",
            headers: { "lib": recherche },
            type: 'GET',
            dataType: "json",
            timeout: 15000
        }).done(
            function (data) {              
            	$("#card-deck").empty();
                for (let i=0; i < data.length;i++){
                	console.log(data[i].image);
                	$("#card-deck").append('<div class="card" style="width: 20rem;"><img class="card-img-top" id="image'+i+'" alt="Card image cap"><div class="card-body"><h5 class="card-title text-center">'+data[i].lib+'</h5><p class="card-text text-justify">'+data[i].instruction+'</p></div><div class="card-body"><a href="#" class="card-link text-center">Voir la recette</a></div></div>');
                	$("#image"+i).attr("src", "data:image/png;base64,"+data[i].image+"");
                }
            });                    
            }
    function image() {
         $.ajax({
            url: "http://localhost:8080/recette/homePageRecette",
            type: 'GET',
            dataType: "json",
            timeout: 15000
        }).done(
            function (data) {
                for (let i = 0; i < data.length; i++) {
                    document.getElementById("image"+i+"").src="data:image/png;base64,"+data[i].image+"";
                    document.getElementById("title"+i+"").textContent=""+data[i].lib+"";
                    document.getElementById("text"+i+"").textContent=""+data[i].instruction+"";
                }
            });     
            
        }
        function getPseudo() {
        	let tempMail = sessionStorage.getItem('Mail');
        	let tempPassword = sessionStorage.getItem('Password');
        	console.log(tempMail, tempPassword);
            $.ajax({ 
                    url: "http://localhost:8080/utilisateur/connexion", 
                    headers: { "mail" : tempMail , "password" : tempPassword},
                    type: 'GET',
                    dataType:"json",
                    timeout: 15000
                }).done(
                    function(data) { 
                    	console.log(data.pseudo);
                        $("#menu_navigation").prepend("<p id='pseudo'>Bienvenue "+data.pseudo+"");
                    });
        }
    </script>


</html>
