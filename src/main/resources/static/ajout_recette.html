<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">
   	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Les Cordons Bleus</title>
</head>

<body>

    <!-- Navbar Top -->
    <nav class="navbar navbartop navbar-expand-sm navbar-light bg-light">
        <a href="index.html" class="navbar-brand">
            <img src="./images/chef.png" height="30" alt="Les Cordons Bleus">Les Cordons Bleus
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>    
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ml-auto">
                <a href="connexion.html" class="nav-item nav-link" title="Connexion"><img src="./images/nav_user.png" height="35" alt="login"></a>
            </div>
        </div>
    </nav>

    <!-- Liste mes recettes -->
<div class="maCreationR">

    <!-- card -->
    <div class="card shadow p-3 mb-5 bg-white rounded">
        <div class="card-body cardR">
        	<form>
            <h1 class="text-center titreCardRecette">Ajouter une recette</h1>
            <p class="card-text titreinfo1R">Selectionnez vos ingrédients et la quantité :</p>
    
                <div class="row">
                
                	<!-- liste groupe ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4 form1" >
                            <select class="custom-select mr-sm-2 select1" id="cat1"> 
                            	<option selected>Faites votre choix...</option>           
                            </select>
                        </div>
                    </div>
					
					<!-- liste sous groupe ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4">
                            <select class="custom-select mr-sm-2 select2" id="cat2">
                            	<option selected>Faites votre choix...</option> 
                            </select>
                        </div>
                    </div>

					<!-- liste sous sous groupe ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4">
                            <select class="custom-select mr-sm-2 select3" id="cat3">
                            	<option selected>Faites votre choix...</option> 
                            </select>
                        </div>
                    </div>
                    
                    <!-- liste ingrédient -->
                    <div class="form-col-4">
                        <div class="col-auto my-4">
                            <select class="custom-select mr-sm-2 select4" id="cat4">
                            	<option selected>Faites votre choix...</option> 
                            </select>
                        </div>
                    </div>
                    
                </div>

<!--   --------------------------------- EN TRAVAUX !!!---------------------------------------------------------- -->
                <!-- Poids -->
                <div class="row">
                    <div class="col-4 poidsR">
                        <div class="input-group">
                            <input type="text" class="form-control poidsAlim" id="poidsAlim" aria-label="Text input with segmented dropdown button" placeholder="quantité">
                            <select class="form-control select5">
                                    <option selected>Unités...</option>
                                    <option value="1">Grammes</option>
                                    <option value="2">Litres</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Validation -->
                <div class="row">
                    <div class="col text-right">
                        <button type="submit" class="btn btn-success validIngredient">Valider</button>
                    </div>
                </div>

                <div class="row recetteIngredientsGeneree">
                </div>

<!--   --------------------------------- FIN TRAVAUX ---------------------------------------------------------- -->

                <div class="conteneurListeIngredients" id="conteneurListeIngredients"></div>

                <div>
                    <h2>Tableau nutritionnel</h2>
                    <div class="nut" id="amidon">Amidon : </div>
                    <div class="nut" id="betaCarotene">Beta Carotène : </div>
                    <div class="nut" id="calcium">Calcium : </div>
                    <div class="nut" id="cholesterol">Cholesterol : </div>
                    <div class="nut" id="eau">Eau : </div>
                    <div class="nut" id="energie">Energie : </div>
                    <div class="nut" id="fer">Fer : </div>
                    <div class="nut" id="fibresAlimentaires">Fibres Alimentaires : </div>
                    <div class="nut" id="glucides">Glucides : </div>
                    <div class="nut" id="iode">Iode : </div>
                    <div class="nut" id="lipides">Lipides : </div>
                    <div class="nut" id="proteines">Protéines : </div>
                    <div class="nut" id="sel">Sel : </div>
                    <div class="nut" id="sucres">Sucres : </div>
                    <div class="nut" id="vitamineB1">Vitamines B1 : </div>
                    <div class="nut" id="vitamineB12">Vitamines B12 : </div>
                    <div class="nut" id="vitamineC">Vitamines C : </div>
                    <div class="nut" id="vitamineD">Vitamines D : </div>
                    <div class="nut" id="vitamineE">Vitamines E : </div>
                </div>

                <div class="recettePreparation">
                    <div class="form-group">
                        <label for="exampleFormControlTextarea1">Préparation :</label>
                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="5"></textarea>
                    </div>
                </div>

                <!-- Validation -->
                <div class="row">
                    <div class="col validAjouR text-right">
                        <button id="validRecette" type="submit" class="btn btn-success">Valider</button>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>
    


    <!-- Footer en mode Desktop-->
    <div class="footerDesktop">
        <div class="footertext1">made with ♥ by LCB
        </div>
        <div class="footertext-links">
            <p>Tous droits réservés Les Cordons Bleus - 2019</br>
                Vous avez une question ? <a href="">nous contacter</a> ∗ 
                <a href="">Mentions légales</a> ∗ 
                <a href="">Conditions Générales d'Utilisation</a> ∗ 
                <a href="">Contact</a> ∗ 
                <a href="">Politique de protection des données personnelles</a> ∗ 
                <a href="">Politique de confidentialité</a> 
            </p>
        </div>
    </div>
    

    <!-- Navbar bottom format mobile xs -->
    <nav class="navbar navbarbottom fixed-bottom navbar-light bg-light">
        <a href="index.html" class="nav-item nav-link"><img src="./images/nav_home.png" height="40" alt="login"></a>
        <a href="#" class="nav-item nav-link"><img src="./images/nav_heart.png" height="40" alt="login"></a>
        <a href="connexion.html" class="nav-item nav-link"><img src="./images/nav_user.png" height="40" alt="login"></a>
        <a href="#" class="nav-item nav-link"><img src="./images/nav_engrenage.png" height="45" alt="login"></a>
    </nav>


	<script>

        var poids;
        var ingredientValue;
        var unite;
        var proprietesIngredient;
        
        recupListes();
        
	    function recupListes(){
	    	var liste;
	    	var numListe;
         	var value1;
         	var value2;
         	var value3;
         	var value4;
         	
         // tableaux recupération ingredients
         	
         	
	        $.ajax({
	            type: 'get',
	            contentType: "application/json",
	            url: "http://localhost:8080/groupe/all/",
	            }).done(function(data) {
	            datas = data;

	
            		

	 			console.log(data);

	            // liste 1 groupe ingrédient 
	            numListe = 1;
	            for (var i = 0; i < datas.length; i++) {
	            	console.log(datas.length);
	                var titre1 = datas[i].lib;
	                $(".select"+numListe).append("<option type=text value="+i+" onclick=selectListe1()>"+titre1+"</option>"); 
	            }
	            
	            // Récupération valeur 1ère liste :
	            $(".select1").on('change', function() {
	            	  value1 = $(this).val();
	            	  $(".select2").empty();
	            	  $(".select3").empty();
	            	  $(".select4").empty();
	            	  
	            	// liste 2 sous groupe ingrédient       	
	  	         	numListe = 2;
	  	         	$(".select"+numListe).append("<option selected>Faites votre choix...</option>");
	  	            for (var j = 0; j < datas[value1].sousGroupeIngredient.length; j++) {
	  	                var titre2 = datas[value1].sousGroupeIngredient[j].lib;
	  	                $(".select"+numListe).append("<option type=text value="+j+" onclick=selectListe2()>"+titre2+"</option>"); 
	  	            }
	  	            
	  	       		// Récupération valeur 2ème liste :
		            $('.select2').on('change', function() {
		            	  value2 = $(this).val();
		            	  $(".select3").empty();
		            	  $(".select4").empty();
	  	            
		  	       		// liste 3 sous sous groupe ingrédient 
			         	numListe = 3;
			         	$(".select"+numListe).append("<option selected>Faites votre choix...</option>");
			            for (var k = 0; k < datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient.length; k++) {
			                var titre3 = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[k].lib;
			                $(".select"+numListe).append("<option type=text value="+k+" onclick=selectListe3()>"+titre3+"</option>"); 
			            }
			         	
			         	// Récupération valeur 3ème liste :
			            $('.select3').on('change', function() {
			            	  value3 = $(this).val();
			            	  $(".select4").empty();
		            	  
			            	// liste 4 ingrédient 
				         	numListe = 4;	
				         	$(".select"+numListe).append("<option selected>Faites votre choix...</option>");
				            for (var l = 0; l < datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients.length; l++) {
				            	console.log("select4")
				                var titre4 = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[l].alimNom;
				                $(".select"+numListe).append("<option type=text id="+l+" value="+l+" onclick=selectListe3()>"+titre4+"</option>"); 
				            }
					         	
				         	// Récupération valeur 4ème liste :
				            $('.select4').on('change', function() {
				            	value4 = $(this).val();
                                ingredientValue = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4].alimNom;
                                proprietesIngredient = datas[value1].sousGroupeIngredient[value2].sousSousGroupeIngredient[value3].ingredients[value4];

					            console.log(ingredientValue,proprietesIngredient);
					            
// --------------------------------- EN TRAVAUX !!!----------------------------------------------------------
								
						
						         // Récupération de la valeur poids ingredient avec validation :
							        $(".validIngredient").click(function(event) {
                                        // Poids quantité aliment champ poidsRecette
                                        console.log(proprietesIngredient.amidon);
                                        
                                        event.preventDefault();
										
                                        
                                        
                                        $("#validRecette").click(function(event){
                                            
                                            calculTotalNutriments();
                                            /*
                                            $.ajax({
                                                type: 'POST',
                                                url: "http://localhost:8080/recette",
                                                //headers:
                                                }).done(function(data) {
                                                    
                                            })
                                            */
                                            event.preventDefault();
                                        })

                                    })
							        	
							        	
// --------------------------------- FIN TRAVAUX !!!----------------------------------------------------------		
							        	
							       
							       
				            })
	            		})
		        	})
	        	})
			})
			
        }
        
        // AFFICHAGE DE LA LISTE DES INGREDIENTS
	    $(".validIngredient").click(function(event) {
	    	poids = $(".poidsAlim").val();
            unite = $(".select5").val();
            if(unite == 1){
                unite = "grammes";
            } else if (unite == 2){
                unite = "litres";
            } else {
                unite = "";
                poids = "";
            }



            afficheIngredient();
            afficheTableauNutritionnel();
	    })
        
        
        
		// AFFICHAGE DE LA LISTE DES INGREDIENTS 
        function afficheIngredient(){
            if (unite == ""){
            	$(".conteneurListeIngredients").append("<div>"+ingredientValue+"</div>");
            } else {
            	$(".conteneurListeIngredients").append("<div>"+poids+" "+unite+" de "+ingredientValue+"</div>");
            }
            
            
        }

        // REMPLISSAGE DU TABLEAU CONTENANT TOUTES LES VALEURS NUTRITIONNELLES PAR INGREDIENT ET EN FONCTION DE LA QUANTITE 
        function afficheTableauNutritionnel(){
            $("#amidon").append("<div class='nutri amidon'>"+proprietesIngredient.amidon/100*poids+"</div>");
            $("#betaCarotene").append("<div class='nutri betaCarotene'>"+proprietesIngredient.betaCarotene/100*poids+"</div>");
            $("#calcium").append("<div class='nutri calcium'>"+proprietesIngredient.calcium/100*poids+"</div>");
            $("#cholesterol").append("<div class='nutri cholesterol'>"+proprietesIngredient.cholosterol/100*poids+"</div>");
            $("#eau").append("<div class='nutri eau'>"+proprietesIngredient.eau/100*poids+"</div>");
            $("#energie").append("<div class='nutri energie'>"+proprietesIngredient.energie/100*poids+"</div>");
            $("#fer").append("<div class='nutri fer'>"+proprietesIngredient.fer/100*poids+"</div>");
            $("#fibresAlimentaires").append("<div class='nutri fibresAlimentaires'>"+proprietesIngredient.fibresAlimentaires/100*poids+"</div>");
            $("#glucides").append("<div class='nutri glucides'>"+proprietesIngredient.glucides/100*poids+"</div>");
            $("#iode").append("<div class='nutri iode'>"+proprietesIngredient.iode/100*poids+"</div>");
            $("#lipides").append("<div class='nutri lipides'>"+proprietesIngredient.lipides/100*poids+"</div>");
            $("#proteines").append("<div class='nutri proteines'>"+proprietesIngredient.proteines/100*poids+"</div>");
            $("#sel").append("<div class='nutri sel'>"+proprietesIngredient.sel/100*poids+"</div>");
            $("#sucres").append("<div class='nutri sucres'>"+proprietesIngredient.sucres/100*poids+"</div>");
            $("#vitamineB1").append("<div class='nutri vitamineB1'>"+proprietesIngredient.vitamineB1/100*poids+"</div>");
            $("#vitamineB12").append("<div class='nutri vitamineB12'>"+proprietesIngredient.vitamineB12/100*poids+"</div>");
            $("#vitamineC").append("<div class='nutri vitamineC'>"+proprietesIngredient.vitamineC/100*poids+"</div>");
            $("#vitamineD").append("<div class='nutri vitamineD'>"+proprietesIngredient.vitamineD/100*poids+"</div>");
            $("#vitamineE").append("<div class='nutri vitamineE'>"+proprietesIngredient.vitamineE/100*poids+"</div>");
        }
        

        // CALCUL DU TOTAL PAR NUTRIMENT DE LA RECETTE
        function calculTotalNutriments(){
            
            var totalAmidon = 0;
            var totalBetaCarotene = 0;
            var totalCalcium = 0;
            var totalCholesterol = 0;
            var totalEau = 0;
            var totalEnergie =0;
            var totalFer=0;
            var totalFibresAlimentaires=0;
            var totalGlucides=0;
            var totalIode=0;
            var totalLipides=0;
            var totalProteines=0;
            var totalSel=0;
            var totalSucres=0;
            var totalVitamineB1=0;
            var totalVitamineB12=0;
            var totalVitamineC=0;
            var totalVitamineD=0;
            var totalVitamineE=0;

            var amidon = $(".amidon");
            var betaCarotene = $(".betaCarotene");
            var calcium = $(".calcium");
            var cholesterol= $(".cholesterol");
            var eau= $(".eau");
            var energie= $(".energie");
            var fer= $(".fer");
            var fibresAlimentaires= $(".fibresAlimentaires");
            var glucides= $(".glucides");
            var iode= $(".iode");
            var lipides= $(".lipides");
            var proteines= $(".proteines");
            var sel= $(".sel");
            var sucres= $(".sucres");
            var vitamineB1= $(".vitamineB1");
            var vitamineB12= $(".vitamineB12");
            var vitamineC= $(".vitamineC");
            var vitamineD= $(".vitamineD");
            var vitamineE= $(".vitamineE");

            for(var i = 0 ; i < amidon.length; i++){
                totalAmidon = totalAmidon + parseFloat(amidon[i].childNodes[0].data);
                totalBetaCarotene = totalBetaCarotene + parseFloat(betaCarotene[i].childNodes[0].data);
                totalCalcium = totalCalcium + parseFloat(calcium[i].childNodes[0].data);
                totalCholesterol = totalCholesterol + parseFloat(cholesterol[i].childNodes[0].data);
                totalEau = totalEau + parseFloat(eau[i].childNodes[0].data);
                totalEnergie = totalEnergie + parseFloat(energie[i].childNodes[0].data);
                totalFer = totalFer + parseFloat(fer[i].childNodes[0].data);
                totalFibresAlimentaires = totalFibresAlimentaires + parseFloat(fibresAlimentaires[i].childNodes[0].data);
                totalGlucides = totalGlucides + parseFloat(glucides[i].childNodes[0].data);
                totalIode = totalIode + parseFloat(iode[i].childNodes[0].data);
                totalLipides = totalLipides + parseFloat(lipides[i].childNodes[0].data);
                totalProteines = totalProteines + parseFloat(proteines[i].childNodes[0].data);
                totalSel = totalSel + parseFloat(sel[i].childNodes[0].data);
                totalSucres = totalSucres + parseFloat(sucres[i].childNodes[0].data);
                totalVitamineB1 = totalVitamineB1 + parseFloat(vitamineB1[i].childNodes[0].data);
                totalVitamineB12 = totalVitamineB12 + parseFloat(vitamineB12[i].childNodes[0].data);
                totalVitamineC = totalVitamineC + parseFloat(vitamineC[i].childNodes[0].data);
                totalVitamineD = totalVitamineD + parseFloat(vitamineD[i].childNodes[0].data);
                totalVitamineE = totalVitamineE + parseFloat(vitamineE[i].childNodes[0].data);
                console.log(totalAmidon,totalBetaCarotene,totalCalcium,totalCholesterol,totalEau,totalEnergie,totalFer,totalFibresAlimentaires,totalGlucides,totalIode,totalLipides,totalProteines,totalSel,totalSucres,totalVitamineB1,totalVitamineB12,totalVitamineC,totalVitamineD,totalVitamineE);

            }
           

            
            
        }
	
	    
	
	</script>
  </body>
</html>
